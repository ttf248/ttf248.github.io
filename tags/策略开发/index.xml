<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>策略开发 on 向叔记事簿</title>
        <link>https://ttf248.life/tags/%E7%AD%96%E7%95%A5%E5%BC%80%E5%8F%91/</link>
        <description>Recent content in 策略开发 on 向叔记事簿</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <lastBuildDate>Thu, 29 Jan 2026 22:52:12 +0800</lastBuildDate><atom:link href="https://ttf248.life/tags/%E7%AD%96%E7%95%A5%E5%BC%80%E5%8F%91/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>回测中的“复权”详解与数据获取</title>
        <link>https://ttf248.life/p/where-can-i-find-backtest-data/</link>
        <pubDate>Fri, 27 Jun 2025 19:33:56 +0800</pubDate>
        
        <guid>https://ttf248.life/p/where-can-i-find-backtest-data/</guid>
        <description>&lt;p&gt;回测必须使用&lt;strong&gt;比例法（涨跌幅复权法）&lt;strong&gt;来处理分红和配股导致的股价变动，因为它能准确反映“分红再投资”下的真实&lt;/strong&gt;总收益率&lt;/strong&gt;。文章通过例子证明，&lt;strong&gt;加减法复权&lt;/strong&gt;会错误地低估复利效果，导致回测结果失真。最后推荐了 &lt;strong&gt;yfinance&lt;/strong&gt; 和 &lt;strong&gt;TuShare&lt;/strong&gt; 等提供比例法复权数据的 Python 数据源。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;原文很啰嗦，gemini-2.5-pro 撰写，改为新模型重写。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;为什么必须用比例法涨跌幅复权&#34;&gt;为什么必须用“比例法”（涨跌幅复权）？
&lt;/h2&gt;&lt;p&gt;在量化回测中，股票价格会因为&lt;strong&gt;分红&lt;/strong&gt;、&lt;strong&gt;拆股&lt;/strong&gt;等行为出现“断层”。为了保证回测的真实性，我们必须对价格进行修复（复权）。&lt;strong&gt;比例法&lt;/strong&gt;（也称涨跌幅复权法）是目前业界公认的标准方法。&lt;/p&gt;
&lt;h3 id=&#34;通俗案例什么是比例法&#34;&gt;通俗案例：什么是比例法？
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;核心逻辑&lt;/strong&gt;：假设你拿到的分红，立刻在当天以收盘价&lt;strong&gt;重新买入&lt;/strong&gt;了这只股票（分红再投资）。它保证了复权后的价格走势，与你满仓持有的&lt;strong&gt;总资产增长率&lt;/strong&gt;完全一致。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;【场景演示】&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;第1天&lt;/strong&gt;：你花 &lt;strong&gt;100元&lt;/strong&gt; 买入1股。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;第2天（除息日）&lt;/strong&gt;：公司发 &lt;strong&gt;10元&lt;/strong&gt; 现金分红。
&lt;ul&gt;
&lt;li&gt;股价自然回落到 &lt;strong&gt;90元&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;你的资产：90元股票 + 10元现金 = 100元（没亏没赚）。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;第3天&lt;/strong&gt;：股价上涨 &lt;strong&gt;10%&lt;/strong&gt;，从90元涨到了 &lt;strong&gt;99元&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;【比例法是如何记录的？】&lt;/strong&gt;
比例法会通过调整历史价格，让K线图体现出这 &lt;strong&gt;10%&lt;/strong&gt; 的真实涨幅。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;它计算出的第3天涨幅：&lt;code&gt;(99 - 90) / 90 = 10%&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;它构建的复权价格序列，会让你看到一条平滑上涨的曲线，真实反映了如果你把那10元分红买成股票，你的总资产实际上涨了10%。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;为什么不能用加减法价格复权&#34;&gt;为什么不能用“加减法”（价格复权）？
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;核心逻辑&lt;/strong&gt;：加减法只是简单粗暴地把分红的钱“加”回到股价上。它最大的问题是&lt;strong&gt;破坏了收益率的真实性&lt;/strong&gt;，导致回测失效。&lt;/p&gt;
&lt;h3 id=&#34;通俗案例加减法的陷阱&#34;&gt;通俗案例：加减法的陷阱
&lt;/h3&gt;&lt;p&gt;沿用上面的例子：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;第2天&lt;/strong&gt;：股价90元，分红10元。加减法处理后的价格 = 90 + 10 = &lt;strong&gt;100元&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;第3天&lt;/strong&gt;：股价涨到99元（市场真实涨幅10%）。加减法处理后的价格 = 99 + 10 = &lt;strong&gt;109元&lt;/strong&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;【问题出在哪？】&lt;/strong&gt;
请计算加减法处理后的“涨幅”：
&lt;/p&gt;
$$(109 - 100) / 100 = 9\%$$
&lt;p&gt;&lt;strong&gt;结论&lt;/strong&gt;：市场明明涨了 &lt;strong&gt;10%&lt;/strong&gt;，但用加减法算出来只有 &lt;strong&gt;9%&lt;/strong&gt;。
因为加减法&lt;strong&gt;无视了复利效应&lt;/strong&gt;——它默认那10元分红变成了死钱，没有参与第3天的上涨。随着时间推移，这种误差会越来越大，导致你的策略回测结果严重失真（通常会低估收益）。&lt;/p&gt;
&lt;h2 id=&#34;推荐支持比例法复权的-python-数据源&#34;&gt;推荐：支持“比例法”复权的 Python 数据源
&lt;/h2&gt;&lt;p&gt;在 Python 中获取数据时，请认准关键词 &lt;strong&gt;Adjusted (Adj)&lt;/strong&gt; 或 &lt;strong&gt;复权&lt;/strong&gt;。&lt;/p&gt;
&lt;h3 id=&#34;yfinance-yahoo-finance--国际通用完全免费&#34;&gt;Yfinance (Yahoo Finance) —— 国际通用，完全免费
&lt;/h3&gt;&lt;p&gt;最适合新手和研究美股/全球市场，默认提供比例法复权数据。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import yfinance as yf

# auto_adjust=True 会自动下载比例法复权后的数据
# 这里的 Close 字段已经是复权后的价格
df = yf.download(&#39;AAPL&#39;, start=&#39;2023-01-01&#39;, auto_adjust=True)
print(df.head())
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;tushare--国内首选数据规范&#34;&gt;Tushare —— 国内首选，数据规范
&lt;/h3&gt;&lt;p&gt;最适合研究 A 股，提供清晰的前复权（qfq）和后复权（hfq）选项。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import tushare as ts

ts.set_token(&#39;你的token&#39;)
pro = ts.pro_api()

# adj=&#39;qfq&#39; 代表使用前复权（比例法）
df = pro.daily(ts_code=&#39;600519.SH&#39;, start_date=&#39;20230101&#39;, adj=&#39;qfq&#39;)
print(df.head())
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;baostock--免费开源无需积分&#34;&gt;Baostock —— 免费开源，无需积分
&lt;/h3&gt;&lt;p&gt;适合 A 股基础数据获取，同样支持复权参数。&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import baostock as bs
import pandas as pd

bs.login()
# adjustflag=&amp;quot;2&amp;quot; 代表前复权
rs = bs.query_history_k_data_plus(&amp;quot;sh.600519&amp;quot;,
    &amp;quot;date,close,adjustflag&amp;quot;,
    start_date=&#39;2023-01-01&#39;, 
    frequency=&amp;quot;d&amp;quot;, 
    adjustflag=&amp;quot;2&amp;quot;) 

# ...后续处理代码...
bs.logout()
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        
    </channel>
</rss>
