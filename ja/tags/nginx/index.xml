<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Nginx on 向叔の手帳</title>
        <link>https://ttf248.life/ja/tags/nginx/</link>
        <description>Recent content in Nginx on 向叔の手帳</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>ja</language>
        <lastBuildDate>Sun, 25 May 2025 14:10:37 +0800</lastBuildDate><atom:link href="https://ttf248.life/ja/tags/nginx/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>ウェブサイトの高速化とドメイン設定</title>
        <link>https://ttf248.life/ja/p/website-acceleration-and-domain-setup/</link>
        <pubDate>Sat, 20 Jun 2020 10:36:27 +0800</pubDate>
        
        <guid>https://ttf248.life/ja/p/website-acceleration-and-domain-setup/</guid>
        <description>&lt;p&gt;国内アクセスがGitHub Pagesよりも遅いため、著者は個人ドメインを申請し、国内クラウドプロバイダーのCDNアクセラレーションサービスを購入しました。設定中に、wwwサブドメインにアクセスできない問題が発生しましたが、最終的にワイルドカードドメイン解析を削除し、セカンダリドメインを個別に設定することで解決しました。また、著者はCDNアクセラレーションの原理と設定経験、Nginxのリバースプロキシの試みと教訓についても共有しています。&lt;/p&gt;
&lt;h3 id=&#34;背景&#34;&gt;背景
&lt;/h3&gt;&lt;p&gt;GitHub Pagesにサイトをホストしているため、周知の理由により、国内からのGitHub Pagesへのアクセスは少し遅いです。そこで、個人ドメインを申請し、国内クラウドプロバイダーのCDN加速サービスを購入しました。加速サービスを設定する際に、開発マシンにあるDocker、frp、k8sなどのサービスが思い浮かびました。これらのサービスにはそれぞれダッシュボードがあるので、無駄にしないという考えで、いくつかのリバースプロキシを設定し、すべてを二级ドメインに割り当てました。&lt;/p&gt;
&lt;p&gt;サブドメインを快適に使っていると突然、wwwサブドメインにアクセスできなくなりました。アリババクラウドでは、www.xiangtianlong.comとxiangtianlong.comの両方をDNSで同時に解析するように設定しており、CDN加速が有効になっていないときは両方のドメインとも正常に使用できていました。&lt;/p&gt;
&lt;p&gt;CDN加速設定時に、セカンダリドメインが多すぎるため汎用ドメインルールを有効にし、すべて開発マシンにルーティングした結果、wwwというセカンダリドメインもダウンしてしまいました。はい、勘違いではありません、wwwプレフィックスはセカンダリドメインです。実際のウェブサイトはGitHub Pagesにデプロイされており、開発マシンにはウェブサイトのキャッシュ情報が一切ありません。&lt;/p&gt;
&lt;p&gt;開発マシンにサイトをデプロイしないのは、静的ブログで、GitHubの提供するアクションと組み合わせることで、自動的に統合して公開できるからだ。最高だ。&lt;/p&gt;
&lt;h3 id=&#34;ドメイン&#34;&gt;ドメイン
&lt;/h3&gt;&lt;p&gt;非専門的なウェブ開発では、ドメインの理解はSEOやクロスドメインの問題には及びません。ブログサイトとして、ベアドメインを使うことでブログ主のサイトが際立ちやすくなります。これは私のように漢字のピンインをドメインにしているような者にとって、それに加え現在のモバイルアクセスが多いことを考えると、入力できる文字数を減らせるというメリットがあります。&lt;/p&gt;
&lt;p&gt;パソコンでは、ショートカットキーを使えばwwwとcomの入力を省略できます。&lt;/p&gt;
&lt;h3 id=&#34;cdn&#34;&gt;CDN
&lt;/h3&gt;&lt;p&gt;アリババクラウドとテンセントクラウドの両方使ったことがあり、初心者でも使いやすいです。テンセントクラウドには関連する概念を個別に解説した動画もあります。CDNの加速原理は京東（ジードン）の倉庫と同じで、新商品を発売したら、事前に全国各地の倉庫に一斉配送し、配送リクエストが発生した際に、最寄りの倉庫から発送します。&lt;/p&gt;
&lt;p&gt;元のURL：ウェブサイトのリソースが最初に保存されていたアドレス&lt;/p&gt;
&lt;p&gt;キャッシュファイル設定、ブラウザのF12、管理コンソール、静的リソースと動的リソースの簡単な分析&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;全件0日有効&lt;/li&gt;
&lt;li&gt;.php;.jsp;.asp;.aspx 0日有効期限&lt;/li&gt;
&lt;li&gt;.jpg;.png;.js;.css;.woff2 有効期限1日&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;テンセントクラウド設定ルール：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;キャッシュの有効期限ルールは最大で10条まで設定可能です。&lt;/li&gt;
&lt;li&gt;複数のキャッシュ失効ルールの優先順位は、下位ルールから適用されます。&lt;/li&gt;
&lt;li&gt;キャッシュの有効期限は最大365日まで設定可能です。&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;痛ましい告白&#34;&gt;痛ましい告白
&lt;/h3&gt;&lt;p&gt;以前使ったことがなかったのでNginxを理解しているつもりでしたが、ウェブサイトを検索すればリバースプロキシの設定がわかると思っていました。しかし、結果は混乱し、半日かけても302のリダイレクトを理解できませんでした。結局、何も成果が出ませんでした。そこで、思いつきでDNS解析からワイルドカードの汎用ドメイン解析を削除し、個々のセカンドレベルドメインを独立して設定しました。その時、突然、阿里云のDNS解析に「表示URLリダイレクト」というモードがあることに気づきました。試してみたところ、これがまさに私が求めていた302のリダイレクトでした。&lt;/p&gt;
&lt;p&gt;最初の二階建てドメインの設定は問題なくアクセスできたのに、2つ目の設定をしたら動かない。しばらく待ってみたら急に使えるようになったので、阿里云のDNS伝播が時々不安定になるようだ。&lt;/p&gt;
&lt;h3 id=&#34;参照資料&#34;&gt;参照資料
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;なぜ最近、ウェブサイトのドメイン名に「www」という接頭辞が付いていないものが増えているのか？&lt;/li&gt;
&lt;li&gt;wwwとしないドメインに違いはありますか？&lt;/li&gt;
&lt;li&gt;Docker nginx リバースプロキシ設定&lt;/li&gt;
&lt;/ul&gt;</description>
        </item>
        
    </channel>
</rss>
