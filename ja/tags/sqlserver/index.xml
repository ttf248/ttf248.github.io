<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>SqlServer on 向叔の手帳</title>
        <link>https://ttf248.life/ja/tags/sqlserver/</link>
        <description>Recent content in SqlServer on 向叔の手帳</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>ja</language>
        <lastBuildDate>Mon, 02 Jun 2025 19:00:25 +0800</lastBuildDate><atom:link href="https://ttf248.life/ja/tags/sqlserver/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>SQL Serverデータベースのディスクファイルの権限を一括で変更する</title>
        <link>https://ttf248.life/ja/p/bulk-modify-sqlserver-database-disk-permissions/</link>
        <pubDate>Tue, 23 Jan 2024 19:06:36 +0800</pubDate>
        
        <guid>https://ttf248.life/ja/p/bulk-modify-sqlserver-database-disk-permissions/</guid>
        <description>&lt;p&gt;会社のセキュリティポリシーの調整により、&lt;code&gt;機械師 mini&lt;/code&gt;は最終的に自宅に転送され、予備サーバーとして使用されることになりました。同時にマシンシステムを再インストールし、&lt;code&gt;ubuntu&lt;/code&gt;が&lt;code&gt;windows server&lt;/code&gt;に切り替えられました。アクティベーション手段が不正であったため、自宅で使用しても問題ないように見えましたが、実際にはアクティベーションができなかったようです。&lt;/p&gt;
&lt;p&gt;非正規のアクティベーション方法により、マイクロソフトの検出がトリガーされ、正常に動作していた半月後にサーバーが起動1時間で自動シャットダウンしました。システムログを調査した結果、盗版が原因であることが判明しました。&lt;/p&gt;
&lt;p&gt;どうすることもできず、再度システムを再インストールし、&lt;code&gt;SqlServer&lt;/code&gt;も再インストールする必要がありました。ファイル権限管理が厳格であるため、データベースへの正常な追加ができなくなってしまいました。&lt;/p&gt;
&lt;h2 id=&#34;エラーメッセージ&#34;&gt;エラーメッセージ
&lt;/h2&gt;&lt;p&gt;システムを再インストールした後、&lt;code&gt;SqlServer&lt;/code&gt;がデータベースに接続しようとすると、オペレーティングシステムのアクセス拒否エラー5120が発生することがあります。&lt;/p&gt;
&lt;h2 id=&#34;処理スクリプト&#34;&gt;処理スクリプト
&lt;/h2&gt;&lt;p&gt;前文リンク：&lt;a class=&#34;link&#34; href=&#34;https://ttf248.life/ja/p/bulk-update-local-git-and-legacy-permissions/&#34; &gt;ローカルGitリポジトリの一括更新&lt;/a&gt;、またしてもこの馴染み深いスクリプトですね。改造して、フォルダをトラバースしながらファイルの権限を変更し、現在のところフル編集権限を持つユーザーに設定します。
ネット上のチュートリアルはほとんどが手動で修正する方法を提示しており、毎回数個のファイルだけ修正するのでしょうか？ 私は毎回多数のファイルを処理する必要があり、すべてを手作業で処理すると、精神的に限界を迎えます。&lt;/p&gt;
&lt;h2 id=&#34;処理スクリプト-1&#34;&gt;処理スクリプト
&lt;/h2&gt;&lt;pre&gt;&lt;code class=&#34;language-shell&#34;&gt;$currentUserName = [System.Security.Principal.WindowsIdentity]::GetCurrent().Name
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
$rootDirectory = &amp;quot;D:\data\2013_RujiaInfo&amp;quot;

Get-ChildItem -Path $rootDirectory -Recurse | ForEach-Object {
    $itemPath = $_.FullName
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;処理スクリプト-2&#34;&gt;処理スクリプト
&lt;/h2&gt;&lt;p&gt;if ($_ -is [System.IO.DirectoryInfo]) {
$icaclsResult = icacls $itemPath /setowner &amp;ldquo;$currentUserName&amp;rdquo; 2&amp;gt;&amp;amp;1
if ($LASTEXITCODE -eq 0) {
Write-Host &amp;ldquo;フォルダ $itemPath の所有者を $currentUserName に変更しました&amp;rdquo;
# 現在のユーザーに書き込み権限を付与
Invoke-Expression &amp;ldquo;icacls &lt;code&gt;&amp;quot;$itemPath&lt;/code&gt;&amp;rdquo; /grant &lt;code&gt;&amp;quot;$($currentUserName):(OI)(CI)F&lt;/code&gt;&amp;quot;&amp;quot;
Write-Host &amp;ldquo;$currentUserName がフォルダを編集するための権限が付与されました&amp;rdquo;
} else {
Write-Host &amp;ldquo;フォルダ $itemPath の所有者を変更できません。エラー情報: $icaclsResult&amp;rdquo;
}
} else {&lt;/p&gt;
&lt;h2 id=&#34;処理スクリプト-3&#34;&gt;処理スクリプト
&lt;/h2&gt;&lt;p&gt;Write-Host &amp;ldquo;フォルダー &amp;lsquo;$itemPath&amp;rsquo; の所有権を変更できません。エラー情報: $icaclsResult&amp;rdquo;
} else {
$takeownResult = icacls $itemPath /setowner &amp;ldquo;$currentUserName&amp;rdquo; 2&amp;gt;&amp;amp;1
if ($LASTEXITCODE -eq 0) {
# 現在のユーザーに書き込み権限を付与
Invoke-Expression &amp;ldquo;icacls &lt;code&gt;&amp;quot;$itemPath&lt;/code&gt;&amp;rdquo; /grant &lt;code&gt;&amp;quot;$($currentUserName):(F)&lt;/code&gt;&amp;quot;&amp;quot;
Write-Host &amp;ldquo;現在のユーザー &amp;lsquo;$currentUserName&amp;rsquo; にファイルの編集権限が付与されました&amp;rdquo;
} else {
Write-Host &amp;ldquo;フォルダー &amp;lsquo;$itemPath&amp;rsquo; の所有権を変更できません。エラー情報: $takeownResult&amp;rdquo;
}
}&lt;/p&gt;
&lt;h2 id=&#34;スクリプト&#34;&gt;スクリプト
&lt;/h2&gt;</description>
        </item>
        
    </channel>
</rss>
